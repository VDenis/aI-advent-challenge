# Telegram –±–æ—Ç—ã —Å GigaChat –∏ Hugging Face

–ü—Ä–æ–µ–∫—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç Telegram-–±–æ—Ç—ã –Ω–∞ Python (aiogram 3) –∏ –∫–ª–∏–µ–Ω—Ç—ã –¥–ª—è GigaChat –∏ Hugging Face Inference API:

- üèó `real_estate` ‚Äî –ø–æ–º–æ—â–Ω–∏–∫ –ø–æ –ø–æ–¥–±–æ—Ä—É –∏ –æ—Ü–µ–Ω–∫–µ –∫–≤–∞—Ä—Ç–∏—Ä —Å —Ä–∞–∑–Ω—ã–º–∏ —Å—Ç–∏–ª—è–º–∏ –æ–±—â–µ–Ω–∏—è.
- ‚úçÔ∏è `literary` ‚Äî –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç, –∫–∞–∫ –º–µ–Ω—è—é—Ç—Å—è –æ—Ç–≤–µ—Ç—ã –º–æ–¥–µ–ª–∏ –ø—Ä–∏ —Ä–∞–∑–Ω—ã—Ö —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞—Ö.
- ü§ñ `hf_demo` ‚Äî —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç –º–æ–¥–µ–ª–∏ Hugging Face (deepseek, llama3, qwen2).
- üõ† `cli/hf_cli.py` ‚Äî CLI –¥–ª—è –æ–¥–∏–Ω–æ—á–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –º–æ–¥–µ–ª–µ–π Hugging Face.
- üßÆ `cli/hf_llama3_openai.py` ‚Äî CLI –¥–ª—è Llama 3 —á–µ—Ä–µ–∑ OpenAI-—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π API Hugging Face —Å –ª–æ–∫–∞–ª—å–Ω—ã–º –ø–æ–¥—Å—á—ë—Ç–æ–º —Ç–æ–∫–µ–Ω–æ–≤.
- üí¨ `cli/history chat/console_chat.py` ‚Äî –∫–æ–Ω—Å–æ–ª—å–Ω—ã–π REPL-–∫–ª–∏–µ–Ω—Ç –¥–ª—è GigaChat —Å –ø–æ–¥—Å—á—ë—Ç–æ–º —Ç–æ–∫–µ–Ω–æ–≤ –∏ —Å–∂–∞—Ç–∏–µ–º –∏—Å—Ç–æ—Ä–∏–∏.

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Python 3.10+
- –¢–æ–∫–µ–Ω Telegram-–±–æ—Ç–∞ (`BOT_TOKEN`)
- –¢–æ–∫–µ–Ω Telegram-–±–æ—Ç–∞ –¥–ª—è Hugging Face –¥–µ–º–æ (`HF_BOT_TOKEN`)
- –¢–æ–∫–µ–Ω Hugging Face Inference API (`HF_TOKEN`)
- –î–æ—Å—Ç—É–ø –∫ GigaChat API: `client_id` –∏ `client_secret` –≤ base64 (`GIGA_CLIENT_BASIC`)

–°–æ–∑–¥–∞–π `.env` –≤ –∫–æ—Ä–Ω–µ:

```env
BOT_TOKEN=—Ç–≤–æ–π_telegram_—Ç–æ–∫–µ–Ω
HF_BOT_TOKEN=—Ç–æ–∫–µ–Ω_–±–æ—Ç–∞_–¥–ª—è_hf_demo
HF_TOKEN=—Ç–æ–∫–µ–Ω_hugging_face_api
GIGA_CLIENT_BASIC=base64(client_id:client_secret)
```

–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π:

```bash
python3 -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate
pip install -r requirements.txt
```

## –ó–∞–ø—É—Å–∫

–†–µ–∞–ª-—ç—Å—Ç–µ–π—Ç –±–æ—Ç:

```bash
python -m bots.real_estate.bot
```

–õ–∏—Ç–µ—Ä–∞—Ç—É—Ä–Ω—ã–π –±–æ—Ç —Å —Ä–∞–∑–Ω—ã–º–∏ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞–º–∏:

```bash
python -m bots.literary.bot
```

Hugging Face –¥–µ–º–æ-–±–æ—Ç:

```bash
python -m bots.hf_demo.bot
```

–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ —Å–µ–ª–µ–∫—Ç–æ—Ä:

```bash
python main.py --bot real_estate
python main.py --bot literary
python main.py --bot hf_demo
```

CLI –¥–ª—è Hugging Face (–æ–¥–∏–Ω–æ—á–Ω—ã–π –∑–∞–ø—Ä–æ—Å):

```bash
python cli/hf_cli.py --model llama3 "–û–±—ä—è—Å–Ω–∏ —Ä–∞–∑–Ω–∏—Ü—É –º–µ–∂–¥—É —ç—Ç–∏–º–∏ –º–æ–¥–µ–ª—è–º–∏"
```

CLI —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ç—Ä—ë—Ö –º–æ–¥–µ–ª–µ–π:

```bash
python cli/hf_cli.py --compare_three "–û–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ –∑–∞–ø—Ä–æ—Å –¥–ª—è —Ç—Ä—ë—Ö –º–æ–¥–µ–ª–µ–π"
```

CLI –¥–ª—è Llama 3 —á–µ—Ä–µ–∑ OpenAI-—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π API Hugging Face (–ø–æ–¥—Å—á—ë—Ç —Ç–æ–∫–µ–Ω–æ–≤ –ª–æ–∫–∞–ª—å–Ω–æ –∏ –ø–æ usage):

```bash
python -m cli.hf_llama3_openai --text "–ü—Ä–∏–≤–µ—Ç! –ö–∞–∫ –¥–µ–ª–∞?"
# –∏–ª–∏
python cli/hf_llama3_openai.py "–ú–Ω–æ–≥–æ—Å—Ç—Ä–æ—á–Ω—ã–π
—Ç–µ–∫—Å—Ç –∏–∑ –∞—Ä–≥—É–º–µ–Ω—Ç–∞"
# –∏–ª–∏ —á—Ç–µ–Ω–∏–µ –∏–∑ —Ñ–∞–π–ª–∞/stdin:
python -m cli.hf_llama3_openai --file ./prompt.txt
```

–ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞:

```
–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –ß–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å —Å–µ–≥–æ–¥–Ω—è?

local_input_tokens: 11
api_prompt_tokens: 12
api_completion_tokens: 64
finish_reason: stop
```

–ö–æ–Ω—Å–æ–ª—å–Ω—ã–π —á–∞—Ç –¥–ª—è GigaChat:

```bash
python "cli/history chat/console_chat.py"
```

–ü–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º —Å–æ–∑–¥–∞–π `.env` (—á–∏—Ç–∞–µ—Ç—Å—è –∏–∑ –∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞), –≤ –Ω—ë–º –º–∏–Ω–∏–º—É–º:

```env
GIGA_CLIENT_BASIC=base64(client_id:client_secret)
# –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ:
GIGA_API_BASE_URL=https://gigachat.devices.sberbank.ru
GIGA_VERIFY_SSL=true
GIGA_MODEL_NAME=GigaChat
```

–ö–æ–º–∞–Ω–¥—ã –≤–Ω—É—Ç—Ä–∏ REPL:
- `/exit` ‚Äî –≤—ã—Ö–æ–¥ (—Å –∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º),
- `/stats` ‚Äî —Ç–æ–∫–µ–Ω—ã –∑–∞–ø—Ä–æ—Å–∞/–æ—Ç–≤–µ—Ç–∞ –∏ —Å—É–º–º–∞ –∑–∞ —Å–µ—Å—Å–∏—é (—Ö—É–∫–∏ –¥–ª—è —Ü–µ–Ω—ã),
- `/clear` ‚Äî –æ—á–∏—Å—Ç–∏—Ç—å runtime-–∏—Å—Ç–æ—Ä–∏—é –∏ summary, —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—É—Å—Ç–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤ JSON,
- `/history` ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å —Ç–µ–∫—É—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è/—Ä–µ–∑—é–º–µ –≤ –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–π –ø–∞–º—è—Ç–∏,
- `/save` ‚Äî –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –∑–∞–ø–∏—Å–∞—Ç—å summary/–º–µ—Ç—Ä–∏–∫–∏ –≤ JSON,
- `/memory` ‚Äî –ø—É—Ç—å –∫ –ø–∞–º—è—Ç–∏, session_id, updated_at, —Ä–∞–∑–º–µ—Ä summary, user_turns,
- `/forget` ‚Äî —É–¥–∞–ª–∏—Ç—å —Ç–µ–∫—É—â—É—é —Å–µ—Å—Å–∏—é –∏–∑ JSON –∏ –Ω–∞—á–∞—Ç—å –Ω–æ–≤—É—é,
- `/load` ‚Äî –ø–µ—Ä–µ—á–∏—Ç–∞—Ç—å JSON –∏ –≤—ã–±—Ä–∞—Ç—å/–ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–µ—Å—Å–∏—é.

–ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –¥–æ 5 –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Å–µ—Å—Å–∏–π: –∏–Ω–¥–µ–∫—Å, updated_at, –∑–∞–≥–æ–ª–æ–≤–æ–∫ (–ø–µ—Ä–≤—ã–µ 100 —Å–∏–º–≤–æ–ª–æ–≤ –ø–µ—Ä–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è). `0` ‚Äî –Ω–æ–≤–∞—è —Å–µ—Å—Å–∏—è, `1..N` ‚Äî –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—É—é (–≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è system-—Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∫—Ä–∞—Ç–∫–∏–º —Ä–µ–∑—é–º–µ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –¥–∏–∞–ª–æ–≥–∞).

–í–Ω–µ—à–Ω—è—è –ø–∞–º—è—Ç—å —Ç–µ–ø–µ—Ä—å —Ö—Ä–∞–Ω–∏—Ç –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è (user/assistant/system/summary) –ø–ª—é—Å summary –∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ:
- –§–∞–π–ª –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é ‚Äî `./.chat_memory.json` (—á–µ–ª–æ–≤–µ–∫–æ—á–∏—Ç–∞–µ–º—ã–π JSON —Å `indent=2`, `ensure_ascii=False`), –ø—É—Ç—å –º–æ–∂–Ω–æ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ñ–ª–∞–≥–æ–º `--memory-file` –∏–ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π `CHAT_MEMORY_FILE` (env –≤—ã—à–µ —Ñ–ª–∞–≥–∞).
- –ü–∞—Ä–∞–º–µ—Ç—Ä `--session-list-limit` (`CHAT_MEMORY_LIST_LIMIT`) –∑–∞–¥–∞—ë—Ç, —Å–∫–æ–ª—å–∫–æ —Å–µ—Å—Å–∏–π –ø–æ–∫–∞–∑–∞—Ç—å –ø—Ä–∏ –≤—ã–±–æ—Ä–µ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 5).
- –°—Ç—Ä—É–∫—Ç—É—Ä–∞: `schema_version`, `sessions` (–º–∞—Å—Å–∏–≤ —Å–µ—Å—Å–∏–π —Å –ø–æ–ª—è–º–∏ `session_id`, `created_at`, `updated_at`, `model_name`, `api_base_url`, `first_user_message`, `title`, `summary`, `user_turns`, `total_input_tokens`, `total_output_tokens`, `is_active`), –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ `active_session_id`.
- –ó–∞–ø–∏—Å—å –∞—Ç–æ–º–∞—Ä–Ω–∞—è: –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª –≤ —Ç–æ–π –∂–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ + `os.replace`, –ø–µ—Ä–µ–¥ –∑–∞–º–µ–Ω–æ–π –ø–∏—à–µ—Ç—Å—è `.bak`.

–ö–∞–∂–¥—ã–µ 5 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –∏—Å—Ç–æ—Ä–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–∂–∏–º–∞–µ—Ç—Å—è –≤ –∫—Ä–∞—Ç–∫–æ–µ —Ä–µ–∑—é–º–µ, —á—Ç–æ–±—ã —ç–∫–æ–Ω–æ–º–∏—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç; –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –æ—Ç–≤–µ—Ç–∞ –∏ –ø–æ—Å–ª–µ –∫–æ–º–∞–Ω–¥ –ø–∞–º—è—Ç—å –∞–≤—Ç–æ-—Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è.

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞

```
.
‚îú‚îÄ‚îÄ bots/
‚îÇ   ‚îú‚îÄ‚îÄ real_estate/      # –ë–æ—Ç –ø–æ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏ (entrypoint bot.py, handlers.py)
‚îÇ   ‚îú‚îÄ‚îÄ literary/         # –ë–æ—Ç —Å —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞–º–∏ (entrypoint bot.py, handlers.py)
‚îÇ   ‚îî‚îÄ‚îÄ hf_demo/          # –ë–æ—Ç –¥–ª—è —Ç–µ—Å—Ç–∞ –º–æ–¥–µ–ª–µ–π Hugging Face
‚îú‚îÄ‚îÄ cli/
‚îÇ   ‚îú‚îÄ‚îÄ hf_cli.py         # CLI –¥–ª—è –æ–¥–∏–Ω–æ—á–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –º–æ–¥–µ–ª–µ–π HF
‚îÇ   ‚îú‚îÄ‚îÄ hf_llama3_openai.py # CLI –¥–ª—è Llama 3 —á–µ—Ä–µ–∑ OpenAI-—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π API HF
‚îÇ   ‚îî‚îÄ‚îÄ history chat/       # –ö–æ–Ω—Å–æ–ª—å–Ω—ã–π —á–∞—Ç —Å —Å–∂–∞—Ç–∏–µ–º –∏—Å—Ç–æ—Ä–∏–∏
‚îÇ       ‚îú‚îÄ‚îÄ console_chat.py
‚îÇ       ‚îú‚îÄ‚îÄ config.py
‚îÇ       ‚îî‚îÄ‚îÄ memory.py        # JSON-–ø–∞–º—è—Ç—å —Å–µ—Å—Å–∏–π –∏ –∞—Ç–æ–º–∞—Ä–Ω–∞—è –∑–∞–ø–∏—Å—å
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îú‚îÄ‚îÄ gigachat/         # –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –∫–ª–∏–µ–Ω—Ç GigaChat
‚îÇ   ‚îî‚îÄ‚îÄ huggingface/      # –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –∫–ª–∏–µ–Ω—Ç Hugging Face Inference API
‚îú‚îÄ‚îÄ main.py               # –ó–∞–ø—É—Å–∫ –Ω—É–∂–Ω–æ–≥–æ –±–æ—Ç–∞ —á–µ—Ä–µ–∑ —Ñ–ª–∞–≥
‚îú‚îÄ‚îÄ requirements.txt
‚îú‚îÄ‚îÄ README.md
‚îî‚îÄ‚îÄ REFACTORING_NOTES.md
```

## –ó–∞–º–µ—á–∞–Ω–∏—è –ø–æ GigaChat

- –í `services/gigachat/config.py` –∑–∞–¥–∞—é—Ç—Å—è –±–∞–∑–æ–≤—ã–µ URL –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.
- SSL-–ø—Ä–æ–≤–µ—Ä–∫–∞ –≤—ã–∫–ª—é—á–µ–Ω–∞ —Ç–∞–∫ –∂–µ, –∫–∞–∫ –≤ –∏—Å—Ö–æ–¥–Ω–æ–º –∫–æ–¥–µ (connector `ssl=False`). –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –≤–∫–ª—é—á–∏ `verify_ssl=True` –≤ –∫–æ–Ω—Ñ–∏–≥–µ.

## Hugging Face

- –ö–æ–Ω—Ñ–∏–≥ –∏ –∫–ª–∏–µ–Ω—Ç: `services/huggingface/config.py` –∏ `services/huggingface/client.py`.
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –∫–æ—Ä–æ—Ç–∫–∏–µ –∏–º–µ–Ω–∞ –º–æ–¥–µ–ª–µ–π: `deepseek`, `llama3`, `qwen2` (–º–∞–ø—è—Ç—Å—è –Ω–∞ –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ id –≤ Hub).
- CLI (`cli/hf_cli.py`) –ø–æ–∑–≤–æ–ª—è–µ—Ç –¥–µ–ª–∞—Ç—å –æ–¥–∏–Ω–æ—á–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∏ —Å—Ä–∞–≤–Ω–∏–≤–∞—Ç—å —Ç—Ä–∏ –º–æ–¥–µ–ª–∏ –ø–æ –æ–¥–Ω–æ–º—É prompt, –ø–µ—á–∞—Ç–∞—è –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞, –ø—Ä–∏–º–µ—Ä–Ω–æ–µ —á–∏—Å–ª–æ —Ç–æ–∫–µ–Ω–æ–≤ –∏ —Å—Ç–æ–∏–º–æ—Å—Ç—å (–∑–∞–ø–æ–ª–Ω–∏ —Ü–µ–Ω—ã –≤ –∫–æ–Ω—Ñ–∏–≥–µ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏).

## –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License
