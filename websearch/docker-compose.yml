services:
  brave-search:
    image: mcp/brave-search:latest
    container_name: websearch-brave
    env_file: .env
    environment:
      - BRAVE_API_KEY=${BRAVE_API_KEY}
      - BRAVE_MCP_TRANSPORT=http
      - BRAVE_MCP_PORT=3000
      - BRAVE_MCP_HOST=0.0.0.0
    ports:
      - "3001:3000"

  desktop-commander:
    build:
      context: ./mcp/desktop-commander-http
    container_name: websearch-desktop
    volumes:
      - ./:/workspace
    environment:
      - DESKTOP_ROOT=/workspace
    ports:
      - "3002:3000"

  gigachat-summary:
    build:
      context: ./mcp/gigachat-summary
    container_name: websearch-gigachat-summary
    env_file: .env
    ports:
      - "3003:3000"

  tui:
    build:
      context: ./tui
    container_name: websearch-tui
    env_file: .env
    depends_on:
      - brave-search
      - desktop-commander
      - gigachat-summary
    environment:
      - PROJECT_ROOT=${PROJECT_ROOT:-/workspace}
      - OUTPUT_DIR=${OUTPUT_DIR:-/workspace/output}
      # обязательный путь /mcp для HTTP MCP (streamable)
      - MCP_BRAVE_URL=${MCP_BRAVE_URL:-http://brave-search:3000/mcp,http://localhost:3001/mcp}
      - MCP_DESKTOP_URL=${MCP_DESKTOP_URL:-http://desktop-commander:3000/mcp,http://localhost:3002/mcp}
      - MCP_SUMMARY_URL=${MCP_SUMMARY_URL:-http://gigachat-summary:3000/mcp,http://localhost:3003/mcp}
    volumes:
      - ./:/workspace
    working_dir: /workspace
    command: ["python", "-m", "websearch_tui.app"]
    stdin_open: true
    tty: true
